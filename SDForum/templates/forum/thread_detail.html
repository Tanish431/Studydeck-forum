{% extends "base.html" %} {% block content %} {% load markdown_extras %}
<h2>{{ thread.title }}</h2>
{% if thread.course %}
<p style="color: blue;">
    Course:
    <a href="{% url 'forum:course_threads' thread.course.code %}">
        {{ thread.course.code }}
    </a>
</p>
{% endif %} {% if thread.is_locked %}
<span style="color: red">Locked</span>
{% endif %}

<p>
    <em>{{ thread.author }}</em>
    at {{ thread.created_at }}
</p>
<p>
    <b>Tags:</b>
    {% for tag in thread.tags.all %}
    <span>{{ tag.name }}</span>{% if not forloop.last %}, {% endif %} {% empty
    %}
    <span>No tags</span>
    {% endfor %}
</p>

<div><b>Post: </b>{{ thread.content|markdownify|safe }}</div>

<form method="post" action="{% url 'forum:thread_like' thread.id %}">
    {% csrf_token %}
    <button type="submit">
        ğŸ‘ {{ thread.likes.count }} {% if user_thread_like %}(Liked){% endif %}
    </button>
</form>
{% if user.is_authenticated %}
<a href="{% url 'forum:report_thread' thread.pk %}">Report thread</a>
{% endif %} {% if user.is_authenticated and user.profile.is_moderator %}
<form method="post" action="{% url 'forum:thread_lock' thread.pk %}">
    {% csrf_token %}
    <button type="submit">
        {% if thread.is_locked %}Unlock{% else %}Lock{% endif %} Thread
    </button>
</form>
{% endif %} {% if user.is_authenticated %} {% if thread.author == user or
user.profile.is_moderator %}
<form method="post" action="{% url 'forum:thread_delete' thread.pk %}">
    {% csrf_token %}
    <button type="submit">Delete Thread</button>
</form>
{% endif %} {% endif %}

<hr />

<h3>Replies</h3>

<ul>
    {% for reply in page_obj %}
    <li>
        {% if reply.is_deleted %}
        <em>[This reply was deleted]</em>
        {% else %}
        <strong>{{ reply.author }}</strong> Â· {{ reply.created_at }}<br />
        <div>{{ reply.content|markdownify|safe }}</div>
        {% if user.is_authenticated %}
        <div class="reply-actions">
            {% if reply.author == user or user.profile.is_moderator %}
            <form
                method="post"
                action="{% url 'forum:reply_delete' reply.id %}"
                style="display: inline"
            >
                {% csrf_token %}
                <button type="submit">Delete</button>
            </form>
            {% endif %}

            <a href="{% url 'forum:report_reply' reply.pk %}">Report</a>

            <form
                method="post"
                action="{% url 'forum:reply_like' reply.id %}"
                style="display: inline"
            >
                {% csrf_token %}
                <button type="submit">ğŸ‘ {{ reply.likes.count }}</button>
            </form>
        </div>
        {% endif %} {% endif %}
    </li>
    {% empty %}
    <li>No replies yet.</li>
    {% endfor %}
</ul>
{% if page_obj.has_other_pages %}
<div>
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">Prev</a>
    {% endif %} Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
    {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}">Next</a>
    {% endif %}
</div>
{% endif %} {% if user.is_authenticated and not thread.is_locked %}
<hr />
<h3>Post a Reply</h3>
<form method="post" action="{% url 'forum:reply_create' thread.id %}">
    {% csrf_token %}
    <textarea name="content" rows="4" required></textarea><br />
    <button type="submit">Reply</button>
</form>
{% endif %}

<p>
    <a href="{% url 'forum:thread_list' thread.category.slug %}">
        â† Back to {{ thread.category.name }}
    </a>
</p>
{% endblock %}
